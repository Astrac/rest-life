"use strict";angular.module("webApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("webApp").controller("MainCtrl",["$scope","LifeSym",function(a,b){var c={v:40,h:60,cellSize:15,cellMargin:0},d=function(a){return c.cellMargin+a*(c.cellSize+2*c.cellMargin)},e=function(a,b){return{x:a,y:b,posX:d(a),posY:d(b),l:c.cellSize}},f=function(){f=[];for(var a=0;a<c.h;a++)for(var b=0;b<c.v;b++)f.push(e(a,b));return f},g={cells:f(),selectedCells:[],"class":function(a){return _.find(g.selectedCells,function(b){return b.x==a.x&&b.y==a.y})?"cell-live":"cell"}},h=function(a){return _.map(a,function(a){return[a.x,a.y]})},i=function(a){return _.map(a,function(a){return e(a[0],a[1])})};a.running=!1,a.startSym=function(){b.startSym(h(g.selectedCells),function(a){g.selectedCells=i(a)}),a.running=!0},a.stopSym=function(){b.stopSym(),a.running=!1},a.toggle=function(a){var b=g.selectedCells.indexOf(a);-1==b?g.selectedCells.push(a):g.selectedCells.splice(b,1)};var j=!1;a.startSelecting=function(){j=!0},a.endSelecting=function(){j=!1},a.updateSelection=function(b){j&&a.toggle(b)},a.clearBoard=function(){g.selectedCells=[]},a.board=g}]),angular.module("webApp").service("LifeSym",["$interval","$http",function(a,b){var c=null,d=[],e=null,f=function(a){e||(e=b({method:"POST",data:{board:a,steps:100},url:"/board"}).success(function(a){d=a.concat(d),e=null}).error(function(){e=null}))},g=function(b,e){if(null!==c)throw new Error("Symulation is already running");c=a(function(){if(d.length>0){var a=_.last(d);d=_.without(d,a),console.log(d.length),e(a)}0==d.length?f(b):d.length<40&&f(_.first(d))},250)};return{startSym:g,stopSym:function(){a.cancel(c),c=null,d=[]}}}]);